<!-- This comment will put IE 6, 7 and 8 in quirks mode -->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>sxmc: MCMC Class Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javaScript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body onload='searchBox.OnSelectItem(0);'>
<!-- Generated by Doxygen 1.6.3 -->
<script type="text/javascript"><!--
var searchBox = new SearchBox("searchBox", "search",false,'Search');
--></script>
<div class="navigation" id="top">
  <div class="tabs">
    <ul>
      <li><a href="index.html"><span>Main&nbsp;Page</span></a></li>
      <li class="current"><a href="annotated.html"><span>Classes</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <img id="MSearchSelect" src="search/search.png"
             onmouseover="return searchBox.OnSearchSelectShow()"
             onmouseout="return searchBox.OnSearchSelectHide()"
             alt=""/>
        <input type="text" id="MSearchField" value="Search" accesskey="S"
             onfocus="searchBox.OnSearchFieldFocus(true)" 
             onblur="searchBox.OnSearchFieldFocus(false)" 
             onkeyup="searchBox.OnSearchFieldChange(event)"/>
        <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
        </div>
      </li>
    </ul>
  </div>
  <div class="tabs">
    <ul>
      <li><a href="annotated.html"><span>Class&nbsp;List</span></a></li>
      <li><a href="functions.html"><span>Class&nbsp;Members</span></a></li>
    </ul>
  </div>
</div>
<div class="contents">
<h1>MCMC Class Reference</h1><!-- doxytag: class="MCMC" -->
<p>Markov Chain Monte Carlo simulator.  
<a href="#_details">More...</a></p>

<p><code>#include &lt;<a class="el" href="mcmc_8h_source.html">mcmc.h</a>&gt;</code></p>

<p><a href="classMCMC-members.html">List of all members.</a></p>
<table border="0" cellpadding="0" cellspacing="0">
<tr><td colspan="2"><h2>Public Member Functions</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classMCMC.html#a6b770d2197d45c0fcc136294fbeec672">MCMC</a> (const std::vector&lt; <a class="el" href="structSignal.html">Signal</a> &gt; &amp;signals, TNtuple *data)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classMCMC.html#a2d7d02c0892819ff5c9f91bc377d1def">~MCMC</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">TNtuple *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classMCMC.html#ac76eeacb8a362af4c62c596380b8da64">operator()</a> (unsigned nsteps, float burnin_fraction, unsigned sync_interval=1000)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">hemi::Array&lt; float &gt; *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classMCMC.html#ab6a9587552fd9b23c2d13d97b791f05a">build_lut</a> (const std::vector&lt; <a class="el" href="structSignal.html">Signal</a> &gt; &amp;signals, TNtuple *data)</td></tr>
<tr><td colspan="2"><h2>Protected Member Functions</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classMCMC.html#a1ed0f9d2fdc8aafec039dfa023289490">nll</a> (const float *v, double *nll, double *event_partial_sums, double *event_total_sum)</td></tr>
<tr><td colspan="2"><h2>Private Attributes</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a417ddd0a6fdee2ea401d3d1ac727171a"></a><!-- doxytag: member="MCMC::nsignals" ref="a417ddd0a6fdee2ea401d3d1ac727171a" args="" -->
unsigned&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classMCMC.html#a417ddd0a6fdee2ea401d3d1ac727171a">nsignals</a></td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">number of signals <br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a65d836666d35f0c4ffb3f94b84082cbc"></a><!-- doxytag: member="MCMC::nevents" ref="a65d836666d35f0c4ffb3f94b84082cbc" args="" -->
unsigned&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classMCMC.html#a65d836666d35f0c4ffb3f94b84082cbc">nevents</a></td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">number of events <br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a1da299776614208fe3cbd4b3e7dad36e"></a><!-- doxytag: member="MCMC::nnllblocks" ref="a1da299776614208fe3cbd4b3e7dad36e" args="" -->
unsigned&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classMCMC.html#a1da299776614208fe3cbd4b3e7dad36e">nnllblocks</a></td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">number of cuda blocks for nll partial sums <br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a52384b7e58b83ab2abd279071b08ad84"></a><!-- doxytag: member="MCMC::nllblocksize" ref="a52384b7e58b83ab2abd279071b08ad84" args="" -->
unsigned&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classMCMC.html#a52384b7e58b83ab2abd279071b08ad84">nllblocksize</a></td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">size of cuda blocks for nll partial sums <br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="af09948388cb5534d9a563a943979eecd"></a><!-- doxytag: member="MCMC::nnllthreads" ref="af09948388cb5534d9a563a943979eecd" args="" -->
unsigned&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classMCMC.html#af09948388cb5534d9a563a943979eecd">nnllthreads</a></td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">number of threads for nll partial sums <br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a67d0ec8275be35be9bbb74fae8821bc6"></a><!-- doxytag: member="MCMC::nreducethreads" ref="a67d0ec8275be35be9bbb74fae8821bc6" args="" -->
unsigned&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classMCMC.html#a67d0ec8275be35be9bbb74fae8821bc6">nreducethreads</a></td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">number of threads to use in partial sum reduction kernel <br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a2259fe2a0027b6b3916e67fbf535e5a7"></a><!-- doxytag: member="MCMC::blocksize" ref="a2259fe2a0027b6b3916e67fbf535e5a7" args="" -->
unsigned&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classMCMC.html#a2259fe2a0027b6b3916e67fbf535e5a7">blocksize</a></td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">size of blocks for per-signal kernels <br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a9e11b4edfaa324abccebd15e5dc96be0"></a><!-- doxytag: member="MCMC::nblocks" ref="a9e11b4edfaa324abccebd15e5dc96be0" args="" -->
unsigned&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classMCMC.html#a9e11b4edfaa324abccebd15e5dc96be0">nblocks</a></td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">number of blocks for per-signal kernels <br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a64e03c6f7d909bdd78ab47e82a378979"></a><!-- doxytag: member="MCMC::varlist" ref="a64e03c6f7d909bdd78ab47e82a378979" args="" -->
std::string&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classMCMC.html#a64e03c6f7d909bdd78ab47e82a378979">varlist</a></td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">string identifier list for ntuple indexing <br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="afe9e36e8bd4bc6658f751ad43b0d58dd"></a><!-- doxytag: member="MCMC::expectations" ref="afe9e36e8bd4bc6658f751ad43b0d58dd" args="" -->
hemi::Array&lt; float &gt; *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classMCMC.html#afe9e36e8bd4bc6658f751ad43b0d58dd">expectations</a></td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">signal rate expectation values <br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a78188ea2b8b1ebc7fde5d82373601532"></a><!-- doxytag: member="MCMC::constraints" ref="a78188ea2b8b1ebc7fde5d82373601532" args="" -->
hemi::Array&lt; float &gt; *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classMCMC.html#a78188ea2b8b1ebc7fde5d82373601532">constraints</a></td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">signal rate gaussian constraints <br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a9ddda71766bb7340985199d8d0557bb6"></a><!-- doxytag: member="MCMC::lut" ref="a9ddda71766bb7340985199d8d0557bb6" args="" -->
hemi::Array&lt; float &gt; *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classMCMC.html#a9ddda71766bb7340985199d8d0557bb6">lut</a></td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Event/PDF probability lookup table. <br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a84bc0adf94974a520b1227190f020917"></a><!-- doxytag: member="MCMC::rngs" ref="a84bc0adf94974a520b1227190f020917" args="" -->
hemi::Array&lt; <a class="el" href="nll__kernels_8h.html#aa4f3692120f92f1d2ab38f02ca8f86ad">RNGState</a> &gt; *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classMCMC.html#a84bc0adf94974a520b1227190f020917">rngs</a></td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">CURAND RNGs, ignored in CPU mode. <br/></td></tr>
</table>
<hr/><a name="_details"></a><h2>Detailed Description</h2>
<p>Markov Chain Monte Carlo simulator. </p>
<p>Given a set of signal PDFs and a dataset, random walk to map out the likelihood space. </p>
<hr/><h2>Constructor &amp; Destructor Documentation</h2>
<a class="anchor" id="a6b770d2197d45c0fcc136294fbeec672"></a><!-- doxytag: member="MCMC::MCMC" ref="a6b770d2197d45c0fcc136294fbeec672" args="(const std::vector&lt; Signal &gt; &amp;signals, TNtuple *data)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">MCMC::MCMC </td>
          <td>(</td>
          <td class="paramtype">const std::vector&lt; <a class="el" href="structSignal.html">Signal</a> &gt; &amp;&nbsp;</td>
          <td class="paramname"> <em>signals</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">TNtuple *&nbsp;</td>
          <td class="paramname"> <em>data</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Constructor</p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>signals</em>&nbsp;</td><td>List of Signals defining the PDFs and expectations </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>data</em>&nbsp;</td><td>The dataset as a TNtuple with fields "e:r" </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a class="anchor" id="a2d7d02c0892819ff5c9f91bc377d1def"></a><!-- doxytag: member="MCMC::~MCMC" ref="a2d7d02c0892819ff5c9f91bc377d1def" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">MCMC::~MCMC </td>
          <td>(</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Destructor</p>
<p>Free HEMI arrays </p>

</div>
</div>
<hr/><h2>Member Function Documentation</h2>
<a class="anchor" id="ab6a9587552fd9b23c2d13d97b791f05a"></a><!-- doxytag: member="MCMC::build_lut" ref="ab6a9587552fd9b23c2d13d97b791f05a" args="(const std::vector&lt; Signal &gt; &amp;signals, TNtuple *data)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">hemi::Array&lt; float &gt; * MCMC::build_lut </td>
          <td>(</td>
          <td class="paramtype">const std::vector&lt; <a class="el" href="structSignal.html">Signal</a> &gt; &amp;&nbsp;</td>
          <td class="paramname"> <em>signals</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">TNtuple *&nbsp;</td>
          <td class="paramname"> <em>data</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Build Pj(xi) lookup table</p>
<p>Build a table with nevents rows and nsignals columns, containing the value of normalized PDF j evaluted at event i.</p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>signals</em>&nbsp;</td><td>Signals defining the PDFs </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>data</em>&nbsp;</td><td>TNtuple defining the dataset </td></tr>
  </table>
  </dd>
</dl>
<dl class="return"><dt><b>Returns:</b></dt><dd>HEMI array of probabilities, indexed as noted above </dd></dl>

</div>
</div>
<a class="anchor" id="a1ed0f9d2fdc8aafec039dfa023289490"></a><!-- doxytag: member="MCMC::nll" ref="a1ed0f9d2fdc8aafec039dfa023289490" args="(const float *v, double *nll, double *event_partial_sums, double *event_total_sum)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void MCMC::nll </td>
          <td>(</td>
          <td class="paramtype">const float *&nbsp;</td>
          <td class="paramname"> <em>v</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">double *&nbsp;</td>
          <td class="paramname"> <em>nll</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">double *&nbsp;</td>
          <td class="paramname"> <em>event_partial_sums</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">double *&nbsp;</td>
          <td class="paramname"> <em>event_total_sum</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [protected]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Evaluate the NLL function</p>
<p>-logL = sum(Nj) + 1/2*sum((r-r')^2/s^2) - sum(log(sum(Nj*Pj(xi))))</p>
<p>Nothing is returned -- the output stays in the nll array, so it can stay on the device.</p>
<p>This is done in three steps, to support running on the GPU:</p>
<p>1. Compute partial sums of chunks of events for the last term 2. Total up partial sums from step 1 3. Add normalization and other constraints with sum from step 2</p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>v</em>&nbsp;</td><td>Parameter vector at which to evaluate </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>nll</em>&nbsp;</td><td>Container for output NLL value </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>event_partial_sums</em>&nbsp;</td><td>Pre-allocated buffer for event term calculation </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>event_total_sum</em>&nbsp;</td><td>Pre-allocated buffer for event term total </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a class="anchor" id="ac76eeacb8a362af4c62c596380b8da64"></a><!-- doxytag: member="MCMC::operator()" ref="ac76eeacb8a362af4c62c596380b8da64" args="(unsigned nsteps, float burnin_fraction, unsigned sync_interval=1000)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">TNtuple * MCMC::operator() </td>
          <td>(</td>
          <td class="paramtype">unsigned&nbsp;</td>
          <td class="paramname"> <em>nsteps</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">float&nbsp;</td>
          <td class="paramname"> <em>burnin_fraction</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">unsigned&nbsp;</td>
          <td class="paramname"> <em>sync_interval</em> = <code>1000</code></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Perform walk.</p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>nsteps</em>&nbsp;</td><td>Number of random-walk steps to take </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>burnin_fraction</em>&nbsp;</td><td>Fraction of initial steps to throw out </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>sync_interval</em>&nbsp;</td><td>How often to copy accepted from GPU to storage </td></tr>
  </table>
  </dd>
</dl>
<dl class="return"><dt><b>Returns:</b></dt><dd>TNtuple containing accepted points and their likelihoods </dd></dl>

</div>
</div>
<hr/>The documentation for this class was generated from the following files:<ul>
<li><a class="el" href="mcmc_8h_source.html">mcmc.h</a></li>
<li>mcmc.cpp</li>
</ul>
</div>
<!--- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&nbsp;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&nbsp;</span>Classes</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&nbsp;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&nbsp;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&nbsp;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&nbsp;</span>Typedefs</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<hr class="footer"/><address style="text-align: right;"><small>Generated on Wed May 22 15:57:24 2013 for sxmc by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.6.3 </small></address>
</body>
</html>
